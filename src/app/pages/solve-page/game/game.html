<div class="game">
  <div class="game-content">
    <div class="game-board-container">
      <div class="game-board">
        @for (slot of guesses(); track $index) {
          <app-guess-slot
            [guess]="$index === guessNum() ? currentGuess().join('') : guesses()[$index]"
            [length]="this.challenge().word.length"
          />
        }
      </div>
    </div>
  </div>

  @if (
    won() === null && !this.challenge().allowNonsense && invalidGuessAttempted()
  ) {
    <p
      class="game__validation"
      [class.game__validation--loading]="guessValidationState() === 'loading'"
      aria-live="assertive"
    >
      @if (guessValidationState() === 'invalid') {
        <span>That word isn't in the dictionary for this challenge.</span>
      } @else {
        <span>Validating word...</span>
      }
    </p>
  }

  <div class="game-footer">
    @if (won() === null) {
      <app-keyboard
        class="game-keyboard"
        [states]="letters()"
        (keypress)="addLetter($event)"
        (delete)="deleteLetter()"
        (submit)="submitGuess()"
      />
    } @else {
      <section class="game-summary" aria-live="polite">
        <header class="game-summary__status">
          <span class="game-summary__label">Result</span>
          <span class="game-summary__score">{{ guessNum() }}/{{ this.challenge().guessLimit }}</span>
        </header>

        <p class="game-summary__badge" [class.game-summary__badge--lost]="won() === false">
          {{ won() ? 'Victory!' : 'Out of guesses!' }}
        </p>

        <p class="game-summary__message">
          {{ won() ? 'Congrats! You solved the challenge.' : 'Too bad! Try again next time.' }}
        </p>

        @if (!won()) {
          <p class="game-summary__answer">
            Answer: <span>{{ this.challenge().word.toUpperCase() }}</span>
          </p>
        }

        <p class="game-summary__cta">Show off how you did!</p>
        <button
          type="button"
          class="game-summary__share"
          [class.game-summary__share--copied]="shareCopied()"
          (click)="share()"
        >
          {{ shareCopied() ? 'Copied to clipboard' : 'Share' }}
        </button>
      </section>
    }
  </div>
</div>
